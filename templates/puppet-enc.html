{% extends "layout.html" %}
{% block head %}{% include 'codemirror.html' %}{% endblock %}
{% block body %}
<script>
$(document).ready(function() {
	var classes_editor = CodeMirror.fromTextArea(document.getElementById('classes'), 
	{
		mode: 'yaml',
		gutters: ["CodeMirror-lint-markers"],
		lint: true,
		indentUnit: 2,
		viewportMargin: Infinity,
	});

	var variables_editor = CodeMirror.fromTextArea(document.getElementById('variables'), 
	{
		mode: 'yaml',
		gutters: ["CodeMirror-lint-markers"],
		lint: true,
		indentUnit: 2,
		viewportMargin: Infinity
	});

	classes_editor.setOption("extraKeys", 
	{
		Tab: function(cm) {
			var spaces = Array(cm.getOption("indentUnit") + 1).join(" ");
			cm.replaceSelection(spaces);
		}
	});

	variables_editor.setOption("extraKeys", 
	{
		Tab: function(cm) {
			var spaces = Array(cm.getOption("indentUnit") + 1).join(" ");
			cm.replaceSelection(spaces);
		}
	});
});
</script>
<form class="form-horizontal" method="POST" role="form">
<input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
	<div class="page-header">
		{% include 'puppet-node-header.html' %}
		<h3><i class="fa fa-fw fa-server"></i> {{ system.name }}</h3>
		<p class="text-muted">Classes, variables and the environment for the node can be customised below</p>
	</div>
	<div class="panel panel-default">
		<div class="panel-heading">Node Options</div>
		<div class="panel-body" style="padding-bottom:0em">
			<div class="form-group">
				<label title="The Common Name (CN) of the certificate registered with the Puppet Master" class="col-sm-2 control-label" for="certname">Cert Name:</label>
				<div class="col-sm-10">
					<p class="form-control-static">{{ system.puppet_certname }}</p>
				</div>
			</div>
			<div class="form-group">
				<label title="The Puppet environment that this node sits in (the actual name within Puppet is given in brackets)" class="col-sm-2 control-label" for="environment">Environment:</label>
				<div class="col-sm-10"> <select class="form-control" id="environment" name="environment">
{%- for environment in environments -%}
{%- if environment.puppet %}
					<option value="{{ environment.id }}"{% if system.puppet_env == environment.puppet %} selected="selected"{% endif %}>{{ environment.name }} ({{ environment.puppet }})</option>
{%- endif %}
{%- endfor %}
				</select></div>
			</div>
			<div class="form-group">
				<div class="col-sm-offset-2 col-sm-10">
					<div class="checkbox" style="padding-top:0em">
						<label title="Check to include the default classes that deploy are standard build" for="include_default"><input type="checkbox" id="include_default" name="include_default"{% if system.puppet_include_default %} checked="checked"{% endif %}/>Include the <a href="{{url_for('puppet_enc_default')}}">default classes</a></label>
					</div>
				</div>
			</div>
		</div>
	</div>
<div class="row">
	<div class="col-md-9">
		<div class="panel panel-default">
			<div class="panel-heading">Editor: Classes</div>
			<div class="panel-body" style="padding:0px">
				<textarea id="classes" name="classes">{{ system.puppet_classes }}</textarea>
			</div>
		</div>

		<div class="panel panel-default">
			<div class="panel-heading">Editor: Global Variables</div>
			<div class="panel-body" style="padding:0px">
				<textarea id="variables" name="variables">{{ system.puppet_variables }}</textarea>
			</div>
		</div>
		
		<button class="btn btn-primary" type="submit">Save Changes</button>
	</div>
	<div class="col-md-3">
		<div class="panel panel-default">
			<div class="panel-heading">Help</div>
			<div class="panel-body">
				<p>Use the <strong>Classes</strong> field to define the classes that this node will import. You can also
				define parameters for the classes. Nodes will also import classes configured in groups and the default node configuration.</p>
				<p>Use the <strong>Global Variables</strong> field to define the global puppet variables that will be sent to all the
				classes imported by this node. Groups and the default node configuration cannot set global variables - only this field can.</p>
				<p>The format of this field is <a href="https://en.wikipedia.org/wiki/YAML" target="_blank">YAML</a>. Use two spaces for indentation. Do not use tabs, but you can safely
					press the tab key within the editor (it will enter 2 spaces for you).</p>
				<div class="text-center">
					<a href="{{url_for('puppet_help')}}" target="_blank" class="btn btn-success btn-lg">Find out more</a>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
